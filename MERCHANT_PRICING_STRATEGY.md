# 商人定价策略重新设计

## 📊 问题分析

### 原定价策略的问题

#### 1. **小麦定价过高**
```python
# 原定价
种子成本: 2金币
小麦售价: 8金币
农夫利润: 8×5 - 2 = 38金币  # ❌ 利润过高！
```

#### 2. **缺少关键原材料**
```python
# 原定价缺少
"buy": {
    "wood": 5,        # ✅ 有木材
    "seed": 2,        # ✅ 有种子
    "bread": 20,      # ✅ 有面包
    # ❌ 缺少小麦！厨师无法购买
}
```

#### 3. **定价策略不合理**
- 没有鼓励村民间交易
- 原材料和产物定价不平衡
- 商人成为主要交易渠道

---

## 🎯 新定价策略设计

### 核心原则

1. **鼓励村民间交易**：商人定价故意不合理
2. **基于生产效率**：考虑成本和体力消耗
3. **完整供应链**：所有原材料和产物都可购买
4. **平衡利润**：避免某个职业过度盈利

### 生产效率分析

```python
# 农夫：1种子 → 5小麦 (20体力)
# 厨师：3小麦 → 2面包 (15体力)  
# 木工：10木材 → 1房子 (30体力)
```

### 新定价策略

```python
MERCHANT_PRICES = {
    # 商人出售（村民购买）- 故意定价较高
    "buy": {
        # 原材料 - 定价较高，鼓励村民间交易
        "wood": 8,        # 木材 (成本较高)
        "seed": 3,         # 种子 (成本较高)
        "wheat": 4,        # 小麦 (成本较高)
        
        # 产物 - 定价很高，鼓励村民间交易
        "bread": 25,       # 面包 (成本很高)
        "house": 200,      # 住房 (成本很高)
        
        # 特殊物品
        "temp_room": 15,  # 临时房间券 (合理定价)
    },
    # 商人收购（村民出售）- 故意定价较低
    "sell": {
        # 原材料 - 收购价很低
        "wood": 2,        # 木材 (收购价很低)
        "seed": 1,        # 种子 (收购价很低)
        "wheat": 2,       # 小麦 (收购价很低)
        
        # 产物 - 收购价较低
        "bread": 8,       # 面包 (收购价较低)
        "house": 80,      # 住房 (收购价较低)
    }
}
```

---

## 💰 利润分析

### 农夫利润分析

#### 从商人购买种子生产
```python
# 成本
种子成本: 3金币
体力成本: 20体力

# 收入选择
卖给商人: 2×5 = 10金币
利润: 10 - 3 = 7金币  # ✅ 合理利润

# 卖给其他村民: 建议价格 3-4金币/个
卖给村民: 3×5 = 15金币  
利润: 15 - 3 = 12金币  # ✅ 更好利润
```

#### 从其他村民购买种子
```python
# 村民间交易价格: 2金币/个种子
种子成本: 2金币
卖给村民: 3×5 = 15金币
利润: 15 - 2 = 13金币  # ✅ 最优利润
```

### 厨师利润分析

#### 从商人购买小麦生产
```python
# 成本
小麦成本: 4×3 = 12金币
体力成本: 15体力

# 收入选择
卖给商人: 8×2 = 16金币
利润: 16 - 12 = 4金币  # ✅ 合理利润

# 卖给其他村民: 建议价格 10-12金币/个面包
卖给村民: 12×2 = 24金币
利润: 24 - 12 = 12金币  # ✅ 更好利润
```

#### 从农夫购买小麦
```python
# 村民间交易价格: 3金币/个小麦
小麦成本: 3×3 = 9金币
卖给村民: 12×2 = 24金币
利润: 24 - 9 = 15金币  # ✅ 最优利润
```

### 木工利润分析

#### 从商人购买木材生产
```python
# 成本
木材成本: 8×10 = 80金币
体力成本: 30体力

# 收入选择
卖给商人: 80×1 = 80金币
利润: 80 - 80 = 0金币  # ❌ 无利润！

# 卖给其他村民: 建议价格 120-150金币/个房子
卖给村民: 120×1 = 120金币
利润: 120 - 80 = 40金币  # ✅ 合理利润
```

#### 从其他木工购买木材
```python
# 村民间交易价格: 3金币/个木材
木材成本: 3×10 = 30金币
卖给村民: 120×1 = 120金币
利润: 120 - 30 = 90金币  # ✅ 最优利润
```

---

## 🎮 游戏策略影响

### 村民间交易优势

| 交易类型 | 商人价格 | 村民间价格 | 优势 |
|----------|----------|------------|------|
| **种子** | 3金币 | 2金币 | 节省33% |
| **小麦** | 4金币 | 3金币 | 节省25% |
| **木材** | 8金币 | 3金币 | 节省62% |
| **面包** | 25金币 | 12金币 | 节省52% |
| **房子** | 200金币 | 120金币 | 节省40% |

### 职业协作策略

#### 农夫-厨师协作
```python
# 农夫
种子成本: 2金币 (村民间)
小麦收入: 3×5 = 15金币 (卖给厨师)
利润: 15 - 2 = 13金币

# 厨师  
小麦成本: 3×3 = 9金币 (从农夫购买)
面包收入: 12×2 = 24金币 (卖给村民)
利润: 24 - 9 = 15金币

# 总利润: 13 + 15 = 28金币 (vs 商人: 7 + 4 = 11金币)
```

#### 木工协作
```python
# 木工A (提供木材)
木材成本: 2金币 (卖给商人)
木材收入: 3×10 = 30金币 (卖给木工B)
利润: 30 - 2 = 28金币

# 木工B (建造房子)
木材成本: 3×10 = 30金币 (从木工A购买)
房子收入: 120×1 = 120金币 (卖给村民)
利润: 120 - 30 = 90金币

# 总利润: 28 + 90 = 118金币 (vs 商人: 0 + 0 = 0金币)
```

---

## 🔄 交易流程示例

### 场景1：农夫向厨师出售小麦

```bash
# 农夫视角
[Day 1 - morning] > trade node2 sell wheat 5 15
✓ 交易请求已发送: sell 5x wheat for 15 gold to node2

# 厨师视角  
[Day 1 - morning] > trades
[1] 交易ID: trade_0
     来自: Alice
     类型: 对方想出售
     物品: 5x wheat
     要价: 15金币
     状态: ⏳ 待处理

[Day 1 - morning] > accept trade_0
✓ 交易已接受！

# 农夫视角
[Day 1 - morning] > confirm trade_0
✓ 交易完成: 出售 5x wheat 给 Bob, 获得 15金币
```

### 场景2：木工间木材交易

```bash
# 木工A (有木材)
[Day 1 - morning] > trade node3 sell wood 10 30
✓ 交易请求已发送: sell 10x wood for 30 gold to node3

# 木工B (需要木材)
[Day 1 - morning] > accept trade_0
✓ 交易已接受！

# 木工A
[Day 1 - morning] > confirm trade_0
✓ 交易完成: 出售 10x wood 给 Charlie, 获得 30金币

# 木工B 建造房子
[Day 1 - noon] > produce
✓ 生产成功: 10x wood → 1x house

# 木工B 出售房子
[Day 1 - evening] > trade node1 sell house 1 120
✓ 交易请求已发送: sell 1x house for 120 gold to node1
```

---

## 📈 经济平衡性

### 价格梯度设计

| 物品 | 商人收购 | 村民间价格 | 商人出售 | 价格梯度 |
|------|----------|------------|----------|----------|
| **种子** | 1金币 | 2金币 | 3金币 | 1:2:3 |
| **小麦** | 2金币 | 3金币 | 4金币 | 2:3:4 |
| **木材** | 2金币 | 3金币 | 8金币 | 2:3:8 |
| **面包** | 8金币 | 12金币 | 25金币 | 8:12:25 |
| **房子** | 80金币 | 120金币 | 200金币 | 80:120:200 |

### 利润分配

| 职业 | 商人交易利润 | 村民间交易利润 | 提升幅度 |
|------|-------------|---------------|----------|
| **农夫** | 7金币 | 13金币 | +86% |
| **厨师** | 4金币 | 15金币 | +275% |
| **木工** | 0金币 | 90金币 | +∞% |

---

## 🎯 设计目标达成

### ✅ 鼓励村民间交易
- 商人定价故意不合理
- 村民间交易利润显著更高
- 形成完整的供应链协作

### ✅ 基于生产效率
- 考虑原材料成本和体力消耗
- 避免某个职业过度盈利
- 平衡各职业的利润空间

### ✅ 完整供应链
- 所有原材料都可购买
- 所有产物都可出售
- 支持跨职业协作

### ✅ 游戏深度
- 增加策略性
- 鼓励社交互动
- 提供多种盈利路径

---

## 🚀 预期效果

### 玩家行为变化

1. **减少对商人的依赖**
   - 商人主要用于紧急购买
   - 村民间交易成为主要渠道

2. **增加社交互动**
   - 主动寻找交易伙伴
   - 建立长期合作关系

3. **提升策略深度**
   - 考虑最优交易时机
   - 平衡短期和长期收益

### 游戏体验提升

- 🎮 **更有趣**：需要思考和策略
- 🤝 **更社交**：鼓励玩家互动
- ⚖️ **更平衡**：各职业都有价值
- 🔄 **更动态**：价格随供需变化

这个新的定价策略将显著提升游戏的策略性和社交性！🎉

